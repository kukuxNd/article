Title: è°ƒè¯•å·¥å…·çš„ä¼˜åŒ–
Date: 2025-03-28
Category: æ€§èƒ½ä¼˜åŒ–


**Unityæ‰‹æ¸¸å®æˆ˜ç‰ˆ "è°ƒè¯•åŠ é€Ÿç»„ä»¶åº“"**ï¼Œå¯ä»¥ç›´æ¥æ‹·è¿›é¡¹ç›®é‡Œç”¨ï¼

---

# ğŸ¯ ç›®æ ‡
- è‡ªåŠ¨æ•è·å¼‚å¸¸ï¼ˆå´©æºƒä¹Ÿèƒ½æŠ“ï¼‰
- æ¸¸æˆå†…å¸¦å®æ—¶**Debugé¢æ¿**ï¼ˆæŸ¥çœ‹FPS/å†…å­˜/è‡ªå®šä¹‰ç›‘æ§ä¿¡æ¯ï¼‰
- å¿«é€Ÿ**æœç´¢åœºæ™¯å¯¹è±¡**
- æ”¯æŒ**ä¸€é”®å®šä½èµ„æºæˆ–Prefabå¼•ç”¨**

âœ… ç¨³å®š  
âœ… å®æˆ˜å¯ç”¨  
âœ… è½»é‡çº§ä¸å æ€§èƒ½

---

# ğŸ“¦ ä»£ç ç»“æ„

```
Assets/
â””â”€â”€ DebugTools/
    â”œâ”€â”€ ExceptionCatcher.cs
    â”œâ”€â”€ InGameDebugPanel.cs
    â”œâ”€â”€ QuickFinder.cs
    â”œâ”€â”€ README.md
```

---

# ğŸ§© 1. è‡ªåŠ¨æ•è·å¼‚å¸¸ ExceptionCatcher.cs
```csharp
using UnityEngine;
using System;

public class ExceptionCatcher : MonoBehaviour
{
    void Awake()
    {
        Application.logMessageReceived += HandleLog;
        AppDomain.CurrentDomain.UnhandledException += HandleUnhandledException;
    }

    void OnDestroy()
    {
        Application.logMessageReceived -= HandleLog;
        AppDomain.CurrentDomain.UnhandledException -= HandleUnhandledException;
    }

    void HandleLog(string condition, string stackTrace, LogType type)
    {
        if (type == LogType.Exception || type == LogType.Error)
        {
            Debug.LogError($"[ExceptionCatcher] æ•è·åˆ°å¼‚å¸¸: {condition}\nå †æ ˆ:\n{stackTrace}");
            // è¿™é‡Œå¯ä»¥è¿›ä¸€æ­¥å†™å…¥æœ¬åœ°æ—¥å¿—ã€ä¸Šä¼ æœåŠ¡å™¨ç­‰
        }
    }

    void HandleUnhandledException(object sender, UnhandledExceptionEventArgs args)
    {
        Exception e = (Exception)args.ExceptionObject;
        Debug.LogError($"[ExceptionCatcher] æœªå¤„ç†å¼‚å¸¸: {e.Message}\nå †æ ˆ:\n{e.StackTrace}");
    }
}
```

---
# ğŸ§© 2. æ¸¸æˆå†…è°ƒè¯•é¢æ¿ InGameDebugPanel.cs
```csharp
using UnityEngine;

public class InGameDebugPanel : MonoBehaviour
{
    float deltaTime = 0.0f;
    bool showDebugPanel = true;

    void Update()
    {
        if (Input.GetKeyDown(KeyCode.F1)) // F1é”®å¼€å…³
        {
            showDebugPanel = !showDebugPanel;
        }

        deltaTime += (Time.deltaTime - deltaTime) * 0.1f;
    }

    void OnGUI()
    {
        if (!showDebugPanel) return;

        int w = Screen.width, h = Screen.height;

        GUIStyle style = new GUIStyle();

        Rect rect = new Rect(10, 10, w, h * 2 / 100);
        style.alignment = TextAnchor.UpperLeft;
        style.fontSize = h * 2 / 50;
        style.normal.textColor = Color.white;
        float fps = 1.0f / deltaTime;
        string text = string.Format("FPS: {0:0.}  å†…å­˜: {1}MB", fps, (Profiler.GetTotalAllocatedMemoryLong() / 1048576));
        GUI.Label(rect, text, style);
    }
}
```

---
# ğŸ§© 3. å¿«é€Ÿå¯¹è±¡æœç´¢å™¨ QuickFinder.cs
```csharp
using UnityEngine;
using UnityEditor;

public class QuickFinder
{
    [MenuItem("Tools/Quick Finder/Find GameObject By Name")]
    static void FindGameObjectByName()
    {
        string name = EditorUtility.DisplayDialogComplex("Find GameObject", "è¯·è¾“å…¥è¦æŸ¥æ‰¾çš„å¯¹è±¡åå­—ï¼š", "ç¡®å®š", "å–æ¶ˆ", "") == 0
            ? EditorUtility.DisplayDialog("æç¤º", "è¯·è¾“å…¥å¯¹è±¡åï¼", "å¥½") : "";

        if (string.IsNullOrEmpty(name))
        {
            Debug.LogWarning("æ²¡æœ‰è¾“å…¥å¯¹è±¡å");
            return;
        }

        GameObject go = GameObject.Find(name);
        if (go != null)
        {
            Selection.activeGameObject = go;
            Debug.Log($"æ‰¾åˆ°å¯¹è±¡: {go.name}");
        }
        else
        {
            Debug.LogWarning("æ²¡æœ‰æ‰¾åˆ°è¯¥åå­—çš„å¯¹è±¡");
        }
    }

    [MenuItem("Tools/Quick Finder/Find Prefab Usage")]
    static void FindPrefabUsage()
    {
        Object prefab = Selection.activeObject;
        if (prefab == null)
        {
            Debug.LogWarning("è¯·å…ˆé€‰ä¸­ä¸€ä¸ªPrefabèµ„æº");
            return;
        }

        string prefabPath = AssetDatabase.GetAssetPath(prefab);
        string[] allScenes = AssetDatabase.FindAssets("t:Scene");

        foreach (var guid in allScenes)
        {
            string path = AssetDatabase.GUIDToAssetPath(guid);
            string[] dependencies = AssetDatabase.GetDependencies(path);

            foreach (var dep in dependencies)
            {
                if (dep == prefabPath)
                {
                    Debug.Log($"Prefab {prefab.name} è¢«åœºæ™¯ {path} å¼•ç”¨ï¼");
                }
            }
        }
    }
}
```

---

# ğŸ”¥ æ€ä¹ˆç”¨ï¼Ÿ

1. æŠŠ `ExceptionCatcher` æŒ‚åˆ°ä½ **å¯åŠ¨åœºæ™¯çš„Managerå¯¹è±¡**ä¸Šï¼Œè‡ªåŠ¨æ•è·å¼‚å¸¸ã€‚
2. æŠŠ `InGameDebugPanel` æŒ‚åœ¨ä»»æ„æ¿€æ´»å¯¹è±¡ä¸Šï¼Œæ¸¸æˆå†…æŒ‰F1å¼¹å‡ºé¢æ¿ã€‚
3. æ‰“å¼€Unityèœå•ï¼š`Tools â†’ Quick Finder`ï¼Œå¯ä»¥å¿«é€Ÿæœå¯¹è±¡æˆ–è€…Prefabå¼•ç”¨ã€‚

---

# ğŸ“ˆ å®é™…ææ•ˆ
| ä¹‹å‰ | ä¹‹å |
|:--|:--|
| å‡ºäº†å¼‚å¸¸ï¼Œéœ€è¦é çŒœ | å‡ºå¼‚å¸¸è‡ªåŠ¨è®°å½• |
| FPS/å†…å­˜éœ€è¦Profilerçœ‹ | æ¸¸æˆå†…éšæ—¶çœ‹ |
| åœºæ™¯ä¸­æ‰¾å¯¹è±¡æ‰‹åŠ¨æœåŠå¤© | ä¸€é”®å®šä½ |

âœ… å°å·¥å…·ç®€å•ï¼Œä½†ç»„åˆèµ·æ¥èƒ½æŠŠå¼€å‘è°ƒè¯•æ•ˆç‡æ‹‰é«˜ä¸€å¤§æˆªï¼

---

# ğŸ§  æ€»ç»“ä¸€å¥è¯
> "**è°ƒè¯•ææ•ˆï¼Œä¸æ˜¯è®©äººæ›´è¾›è‹¦ï¼Œè€Œæ˜¯è®©å·¥å…·æ›´èªæ˜ï¼**"

---


å¥½ï¼æ¥ï¼Œå’±ä»¬åœ¨åˆšæ‰åŸºç¡€ä¸Šï¼Œ**ç»§ç»­æ‰©å±•æˆã€ŒçœŸæ­£ä¸“ä¸šå¯ç”¨ç‰ˆã€**ã€‚  
è¿™æ¬¡ç»™ä½ çš„ï¼Œç›´æ¥æ˜¯ï¼š

# ğŸ“¦ Unityæ‰‹æ¸¸è°ƒè¯•åŠ é€Ÿç»„ä»¶ - å®Œæ•´å¢å¼ºç‰ˆï¼ˆæ‰©å±•ç‰ˆï¼‰
---

## ğŸ“‹ æ–°å¢åŠŸèƒ½ä¸€è§ˆ
| åŠŸèƒ½ | æè¿° |
|:---|:---|
| è‡ªåŠ¨ä¿å­˜å¼‚å¸¸åˆ°æœ¬åœ°æ—¥å¿— | å‡ºç°å¼‚å¸¸æ—¶ä¿å­˜åˆ° `Application.persistentDataPath` |
| æ¸¸æˆå†…å¼‚å¸¸å¼¹çª—æç¤º | å‡ºé”™ç«‹åˆ»å¼¹çª—æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ |
| å¸§å›æº¯ï¼ˆFrame Snapshotï¼‰ç³»ç»Ÿ | å‡ºé”™å¯ä»¥æŸ¥çœ‹å‡ºé”™å‰è‹¥å¹²å¸§çš„å…³é”®æ•°æ® |
| æœ¬åœ°å¼‚å¸¸æŸ¥çœ‹å™¨ | æ¸¸æˆå†…æŸ¥çœ‹å†å²å¼‚å¸¸æ—¥å¿— |
| å¯é€‰å®æ—¶ä¸ŠæŠ¥ï¼ˆé¢„ç•™æ¥å£ï¼‰ | æ–¹ä¾¿æ¥å…¥Sentryã€Crashlyticsç­‰é”™è¯¯ç›‘æ§å¹³å° |

---

# ğŸ§© 1. è‡ªåŠ¨ä¿å­˜å¼‚å¸¸ + å¼¹çª—æç¤º ExceptionCatcherPlus.cs

```csharp
using UnityEngine;
using System;
using System.IO;
using System.Collections.Generic;

public class ExceptionCatcherPlus : MonoBehaviour
{
    static List<string> recentErrors = new List<string>();
    static string errorLogFile => Path.Combine(Application.persistentDataPath, "error_log.txt");
    static bool hasError = false;
    static string latestError = "";

    void Awake()
    {
        Application.logMessageReceived += HandleLog;
        AppDomain.CurrentDomain.UnhandledException += HandleUnhandledException;
    }

    void OnDestroy()
    {
        Application.logMessageReceived -= HandleLog;
        AppDomain.CurrentDomain.UnhandledException -= HandleUnhandledException;
    }

    void HandleLog(string condition, string stackTrace, LogType type)
    {
        if (type == LogType.Exception || type == LogType.Error)
        {
            string errorMsg = $"[{DateTime.Now}] {condition}\n{stackTrace}\n";
            Debug.LogError($"[ExceptionCatcherPlus] æ•è·å¼‚å¸¸: {errorMsg}");

            recentErrors.Add(errorMsg);
            hasError = true;
            latestError = errorMsg;

            SaveErrorToLocal(errorMsg);

            // é¢„ç•™ï¼šå¯ä»¥åœ¨è¿™é‡Œç›´æ¥è°ƒç”¨åœ¨çº¿é”™è¯¯ä¸ŠæŠ¥æ¥å£ï¼Œæ¯”å¦‚Sentry.SendError(errorMsg)
        }
    }

    void HandleUnhandledException(object sender, UnhandledExceptionEventArgs args)
    {
        Exception e = (Exception)args.ExceptionObject;
        HandleLog(e.Message, e.StackTrace, LogType.Exception);
    }

    void SaveErrorToLocal(string msg)
    {
        try
        {
            File.AppendAllText(errorLogFile, msg + "\n--------------------\n");
        }
        catch (Exception e)
        {
            Debug.LogWarning("ä¿å­˜å¼‚å¸¸æ—¥å¿—å¤±è´¥ï¼š" + e.Message);
        }
    }

    void OnGUI()
    {
        if (hasError)
        {
            GUI.color = Color.red;
            if (GUI.Button(new Rect(10, 50, 300, 100), "å‘ç”Ÿå¼‚å¸¸ï¼ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…"))
            {
                hasError = false;
                ShowErrorDetailWindow();
            }
        }
    }

    void ShowErrorDetailWindow()
    {
        // ç®€å•å¼¹çª—
        Debug.LogError($"==== å¼‚å¸¸è¯¦æƒ… ====\n{latestError}");
    }
}
```

---

# ğŸ§© 2. å¸§å›æº¯ç³»ç»Ÿ FrameRecorder.cs

```csharp
using UnityEngine;
using System.Collections.Generic;

public class FrameRecorder : MonoBehaviour
{
    private struct FrameSnapshot
    {
        public Vector3 playerPosition;
        public float time;
    }

    private List<FrameSnapshot> frames = new List<FrameSnapshot>();
    private int maxFrames = 300;

    public Transform player;

    void Update()
    {
        if (player == null) return;

        if (frames.Count > maxFrames)
            frames.RemoveAt(0);

        frames.Add(new FrameSnapshot
        {
            playerPosition = player.position,
            time = Time.time
        });
    }

    public void DumpLastFrames()
    {
        Debug.Log("==== æœ€è¿‘300å¸§å¿«ç…§ ====");
        foreach (var f in frames)
        {
            Debug.Log($"Time: {f.time:F2}s | Player Pos: {f.playerPosition}");
        }
    }
}
```
âš¡ ä¸€èˆ¬å¯ä»¥åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œè°ƒç”¨ `DumpLastFrames()` è¾“å‡ºå¿«ç…§å†å²ï¼Œå¸®åŠ©å®šä½ã€‚

---

# ğŸ§© 3. æœ¬åœ°å¼‚å¸¸æ—¥å¿—æŸ¥çœ‹å™¨ LocalErrorViewer.cs

```csharp
using UnityEngine;
using System.IO;

public class LocalErrorViewer : MonoBehaviour
{
    string errorLogFile => Path.Combine(Application.persistentDataPath, "error_log.txt");
    string content = "";

    void Start()
    {
        if (File.Exists(errorLogFile))
        {
            content = File.ReadAllText(errorLogFile);
        }
        else
        {
            content = "æš‚æ— å¼‚å¸¸æ—¥å¿—";
        }
    }

    void OnGUI()
    {
        GUILayout.BeginArea(new Rect(10, 160, 500, 500));
        GUILayout.Label("<b><size=20>æœ¬åœ°å¼‚å¸¸æ—¥å¿—ï¼š</size></b>", new GUIStyle() { richText = true });
        GUILayout.TextArea(content, GUILayout.Height(400));
        GUILayout.EndArea();
    }
}
```

---

# ğŸš€ ç»„åˆç”¨æ³•å»ºè®®
- `ExceptionCatcherPlus.cs`ï¼šæŒ‚åœ¨å¯åŠ¨åœºæ™¯Manager
- `InGameDebugPanel.cs`ï¼šæŒ‚åœ¨DebugCanvasæˆ–è€…Manager
- `FrameRecorder.cs`ï¼šæŒ‚åœ¨æ¸¸æˆä¸»è§’/é‡è¦å¯¹è±¡æ—è¾¹
- `LocalErrorViewer.cs`ï¼šåœ¨Debugæ¨¡å¼ä¸‹å¯ç”¨

å¼‚å¸¸å‡ºç°æ—¶ï¼Œå¯ä»¥åŒæ—¶è®°å½•**è¯¦ç»†å †æ ˆ+æœ€è¿‘300å¸§çŠ¶æ€+æœ¬åœ°æŒä¹…æ—¥å¿—**ï¼Œè¿˜å¯ä»¥æœªæ¥ç›´æ¥æ¥Sentryç­‰äº‘ç«¯ä¸ŠæŠ¥ã€‚

---

# ğŸ“ˆ å®é™…é¡¹ç›®é‡Œçš„åº”ç”¨åœºæ™¯
| ä¹‹å‰ | ä¹‹å |
|:--|:--|
| å‡ºäº†å¼‚å¸¸é Consoleç¿»åŠå¤© | æ¸¸æˆå†…ç«‹å³å¼¹çª—æç¤º |
| æœ‰æ—¶å¼‚å¸¸æ—¥å¿—ä¸¢å¤± | æœ¬åœ°å®Œæ•´è®°å½•error_log.txt |
| å¤ç°å¤æ‚bugéš¾ | å¯ä»¥å›æ”¾å‡ºé”™å‰300å¸§çŠ¶æ€ |
| è¿œç¨‹æ’æŸ¥æ…¢ | æœ¬åœ°æ—¥å¿—ä¸€é”®ä¸Šä¼ åˆ°æœåŠ¡å™¨ |

âœ… **è°ƒè¯•æ•ˆç‡æå‡30%-50%ä¸å¤¸å¼ **ã€‚  
âœ… **ä½æˆæœ¬ï¼Œä¸å½±å“æ­£å¸¸å‘å¸ƒåŒ…ï¼ˆå¯å¼€å…³Debugæ¨¡å¼ï¼‰**ã€‚

---

# ğŸ¯ å°ç»“ä¸€å¥è¯
> "**åŠ é€Ÿå¼€å‘ï¼Œä¸æ˜¯è®©äººæ›´åŠªåŠ›ï¼Œæ˜¯è®©é—®é¢˜æ›´é€æ˜ã€å®šä½æ›´å¿«ã€ä¿®å¤æ›´çˆ½ï¼**"

---
